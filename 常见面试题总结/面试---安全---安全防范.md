## XSS

> 涉及面试题：什么是XSS攻击？如何防范XSS攻击？什么是CSP？

### 什么是XSS攻击

XSS（跨站脚本攻击），XSS的原理是攻击者恶意往web界面插入恶意可执行网页脚本代码。所以当用户浏览的时候，嵌入其中的恶意脚本代码就会被执行。

XSS可以分为多种类型，但是总体上我任务分为两类：

- 持久型
- 非持久型

持久型也就是攻击的代码会被写进服务端的数据库中，这种攻击危害性很大，如果网站访问量很大的话，就会导致大量正常访问页面的用户都受到攻击。

非持久型相比于前者危害就小很多，一般通过修改URL参数的方式加入攻击代码，诱导用户访问链接从而进行攻击。

非持久型攻击有以下几个特征：

- 即时性，不通过服务器存储，直接通过HTTP的get和post请求就能完成一次攻击，拿到用户隐私数据
- 攻击者需要诱导点击链接
- 反馈率低

对于非持久型攻击来说，如果用户使用Chrome这类浏览器的话，浏览器就能自动帮助用户防御攻击，但是我们不能因此就不防御此类攻击了，因为我们不能确保用户都适用了这类浏览器。

### 如何防范XSS攻击

**转义字符**

首先，对于用户的输入应该是永远不相信的，最普遍的做法就是转义输入输出的内容，对于引号、尖括号、斜杠进行转义。

但是对于显示富文本来说，显然不能通过上面提到的办法来转义所有的字符，因为这样就会把需要的格式过滤掉。对于这种情况，通常采用白名单过滤的办法。

**CSP**

CSP本质上就是建立白名单，开发者明确告诉浏览器哪些外部资源可以加载和执行

通常可以通过两种方式来开启CSP：

- 设置HTTP Header中的Content-Security-Police
- 设置meta标签的方式<meta http-equiv="Content-Security-Policy">

对于这种方式来说，只要开发者匹配了正确的规则，那么即使网站存在漏洞，攻击者也不能执行他的代码，并且CSP的兼容性也不错。

## CSRF

> 设计面试题：什么是CSRF攻击？如何防范CSRF攻击?

### 什么是CSRF攻击

CSRF（跨站请求伪造），完成CSRF攻击必须要有三个条件：

- 用户已经登录了站点A，并在本地记录了cookie
- 在用户没有登出站点A的情况下，访问了攻击者提供的页面B
- 站点A没有做任何CSRF防御

### 如何防范CSRF攻击

防范CSRF攻击的几种规则：

- get请求不对数据进行修改
- 不能让第三方网站访问到cookie
- 阻止第三方网站请求接口
- 请求时附带验证信息，比如token

**SameSite**

可以对cookie设置SameSite属性，该属性表示cookie不随着跨域请求发送，可以很大程度减少CSRF攻击，但是该属性目前并不是所有浏览器都兼容

**验证Referer**

对于需要防范的CSRF的请求，可以通过验证Referer来判断该请求是否为第三方网站发起的，Referer是HTTP Header中的一个属性

**token**

服务器下发一个随机token，每次发起请求时将token携带上，服务器验证token是否有效。
